openapi: 3.0.0
info:
  title: RAG Chatbot API
  description: API for the RAG chatbot system that allows frontend to communicate with backend for query processing
  version: 1.0.0
servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.rag-chatbot.com
    description: Production server

paths:
  /api/v1/query:
    post:
      summary: Submit a query to the RAG system
      description: Send a user query to the backend for processing with the retrieval-augmented generation system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
      responses:
        '200':
          description: Successful response with answer and metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryResponse'
        '400':
          description: Bad request - invalid query format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/health:
    get:
      summary: Health check endpoint
      description: Check if the RAG system is operational
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: System is not healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    QueryRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: The user's question or query
          example: "What are the key principles of RAG systems?"
        userId:
          type: string
          description: Optional user identifier for tracking
          example: "user-12345"
        sessionId:
          type: string
          description: Optional session identifier for conversation context
          example: "session-67890"

    QueryResponse:
      type: object
      required:
        - response
        - query_id
        - confidence_score
      properties:
        response:
          type: string
          description: The AI-generated response to the query
          example: "RAG systems combine retrieval and generation components..."
        query_id:
          type: string
          description: Unique identifier for the query
          example: "query-abc123"
        retrieved_chunks:
          type: array
          description: The content chunks retrieved from the vector database
          items:
            $ref: '#/components/schemas/RetrievedChunk'
        confidence_score:
          type: number
          description: Confidence score for the response (0-1)
          format: float
          minimum: 0
          maximum: 1
          example: 0.85
        sources:
          type: array
          description: List of source URLs used in the response
          items:
            type: string
            example: "https://example.com/book/chapter1"

    RetrievedChunk:
      type: object
      required:
        - id
        - content
        - source_url
        - similarity_score
      properties:
        id:
          type: string
          description: Unique identifier for the retrieved content chunk
          example: "chunk-xyz789"
        content:
          type: string
          description: The actual text content retrieved from the vector database
          example: "Retrieval-Augmented Generation (RAG) is a technique that combines..."
        source_url:
          type: string
          description: URL or identifier of the original source document
          example: "https://example.com/book/chapter2"
        similarity_score:
          type: number
          description: Semantic similarity score to the original query (0-1)
          format: float
          minimum: 0
          maximum: 1
          example: 0.92
        metadata:
          type: object
          description: Additional metadata associated with the chunk
          example: {"section": "introduction", "page": 5}

    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - version
      properties:
        status:
          type: string
          description: Health status of the system
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the health check
          example: "2023-10-05T14:48:00.000Z"
        version:
          type: string
          description: Version of the API
          example: "1.0.0"

    ErrorResponse:
      type: object
      required:
        - detail
        - timestamp
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "Query too long. Maximum 1000 characters allowed."
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the error occurred
          example: "2023-10-05T14:48:00.000Z"
        error_code:
          type: string
          description: Machine-readable error code
          example: "QUERY_TOO_LONG"